<!doctype html> <html lang=en> <head> <meta charset=utf-8> <meta content="width=device-width,initial-scale=1" name=viewport> <meta content=#333333 name=theme-color> <base href=/ > <link href=css/global.css rel=stylesheet> <link href=manifest.json rel=manifest> <link href=favicon.ico rel=icon type=image/png> <link href=client/main.2444170631.css rel=stylesheet><link href=client/[slug].227aa286.css rel=stylesheet><link href=client/app.900f9ceb.css rel=stylesheet> <noscript id=sapper-head-start></noscript><title>React Native Part 3</title> <meta content="Author: Liam, Date: 17 Oct, 2015\n In react native AwesomeProject example, it gets bundle files with 2 options:

Load from development server
Load from pre-bundled file on disk
" name=description> <meta content=article name=og:type> <meta content=https://leliam.com/blogposts/react-native-part-3-@77YoBE6g82SUQs0QkEGogP name=og:url> <meta content="React Native Part 3" name=og:title> <meta content="In react native AwesomeProject example, it gets bundle files with 2 options:\n\nLoad from development server\nLoad from pre-bundled file on disk\n" name=og:description><noscript id=sapper-head-end></noscript> </head> <body> <div id=sapper> <div style="min-height:calc(100vh - 48px)"> <nav aria-label="main navigation" class="svelte-1dif8ux navbar" role=navigation> <div class=navbar-brand> <a href=/ class="svelte-1dif8ux navbar-item" style=margin:5px><div class="is-4 subtitle">Le Liam</div></a> <a href=/ class="svelte-1dif8ux navbar-item">Home</a> <a href=/tags class="svelte-1dif8ux navbar-item">Tags</a> <a href=/blogposts class="svelte-1dif8ux navbar-item is-active">Blogposts</a> <a href=/contact class="svelte-1dif8ux navbar-item">Contact</a> </div> </nav> <main> <div class="container is-fluid"> <div class=media style="margin:25px 0"> <div class=media-left> <figure class="image is-48x48"> <img alt="Author avatar" loading=lazy src=/assets/32x32_avatar.jpg class=is-rounded> </figure> </div> <div class=media-content> <p class="is-4 title">Liam</p> <p class="subtitle is-6">17 Oct, 2015</p> </div> </div> <div style="margin:0 0 25px"> <img alt="blogpost banner" loading=lazy src=/assets/2015101000.png style="margin:0 auto;display:block"> </div> <h3 class=title>React Native Part 3</h3> <div class="content svelte-nn94v0"> <p>In react native AwesomeProject example, it gets bundle files with 2 options:</p> <ol> <li>Load from development server</li> <li>Load from pre-bundled file on disk</li> </ol> <h2>Hybrid options?</h2> <p>The react native default options looks good, but not good enough.</p> <p>We would like it to load from development server asynchronously, and load from pre-bundled file on disk when the new bundled file is not ready yet.</p> <p>Good news - with some enhance on the AppDelegate.m file that come with the AwesomeProject, it can be archieved!</p> <h2>Coding</h2> <p><a href=https://gist.github.com/nghenglim/46391331d443165d9d53>View AppDelegate.m at Github</a></p> <p>First declare the variable, and set the filepath default store and get from the document directory.</p> <pre class=hljs><code>NSArray   *paths = NSSearchPathForDirectoriesInDomains(NSDocumentDirectory, NSUserDomainMask, YES);
NSString  *documentsDirectory = [paths objectAtIndex:0];
NSString  *filePath = [NSString stringWithFormat:@"%@/%@", documentsDirectory,@"index.ios.bundle"];
</code></pre> <p>Under OPTION 2, asynchronously download file from server. Detect if the file exist in document directory, if the new bundle file exist, load from the document directory. Else, load from the pre-bundled file on the disk:</p> <pre class=hljs><code>dispatch_async(dispatch_get_global_queue(DISPATCH_QUEUE_PRIORITY_DEFAULT, 0), ^{
  NSURL  *url = [NSURL URLWithString:@"http://localhost:8081/index.ios.bundle?platform=ios&dev=true"];
  NSData *urlData = [NSData dataWithContentsOfURL:url];
  if ( urlData )
  {
    //saving is done on main thread
    dispatch_async(dispatch_get_main_queue(), ^{
      [urlData writeToFile:filePath atomically:YES];
    });
  }
});

BOOL fileExists = [[NSFileManager defaultManager] fileExistsAtPath:filePath];
if (fileExists) {
  jsCodeLocation = [[NSURL alloc] initFileURLWithPath:filePath];
} else {
  jsCodeLocation = [[NSBundle mainBundle] URLForResource:@"main" withExtension:@"jsbundle"];
}
</code></pre> <h2>Some note</h2> <p>This method still have many more enhancement can be done, however its enough to showcase the possibility of react native to asynchronously load file from server, and use the new bundle file when it is ready.</p> </div> </div> </main> </div> <footer style=height:48px;padding:10px> <div class="content has-text-centered"> <a href=/privacy-policy>privacy policy</a> · ©2018-2020 Le Liam · <a href=/terms-of-service>TOS</a> </div> </footer></div> <script crossorigin=anonymous src="https://polyfill.io/v3/polyfill.min.js?features=fetch%2CPromise"></script> <script>__SAPPER__={baseUrl:"",preloaded:[void 0,null,{post:{slug:"react-native-part-3-@77YoBE6g82SUQs0QkEGogP",title:"React Native Part 3",description:"\u003Cp\u003EIn react native AwesomeProject example, it gets bundle files with 2 options:\u003C\u002Fp\u003E\n\u003Col\u003E\n\u003Cli\u003ELoad from development server\u003C\u002Fli\u003E\n\u003Cli\u003ELoad from pre-bundled file on disk\u003C\u002Fli\u003E\n\u003C\u002Fol\u003E\n",banner:"\u002Fassets\u002F2015101000.png",author:{avatar:"\u002Fassets\u002F32x32_avatar.jpg",name:"Liam"},data:"\u003Cp\u003EIn react native AwesomeProject example, it gets bundle files with 2 options:\u003C\u002Fp\u003E\n\u003Col\u003E\n\u003Cli\u003ELoad from development server\u003C\u002Fli\u003E\n\u003Cli\u003ELoad from pre-bundled file on disk\u003C\u002Fli\u003E\n\u003C\u002Fol\u003E\n\u003Ch2\u003EHybrid options?\u003C\u002Fh2\u003E\n\u003Cp\u003EThe react native default options looks good, but not good enough.\u003C\u002Fp\u003E\n\u003Cp\u003EWe would like it to load from development server asynchronously, and load from pre-bundled file on disk when the new bundled file is not ready yet.\u003C\u002Fp\u003E\n\u003Cp\u003EGood news - with some enhance on the AppDelegate.m file that come with the AwesomeProject, it can be archieved!\u003C\u002Fp\u003E\n\u003Ch2\u003ECoding\u003C\u002Fh2\u003E\n\u003Cp\u003E\u003Ca href=\"https:\u002F\u002Fgist.github.com\u002Fnghenglim\u002F46391331d443165d9d53\"\u003EView AppDelegate.m at Github\u003C\u002Fa\u003E\u003C\u002Fp\u003E\n\u003Cp\u003EFirst declare the variable, and set the filepath default store and get from the document directory.\u003C\u002Fp\u003E\n\u003Cpre class=\"hljs\"\u003E\u003Ccode\u003ENSArray   *paths = NSSearchPathForDirectoriesInDomains(NSDocumentDirectory, NSUserDomainMask, YES);\nNSString  *documentsDirectory = [paths objectAtIndex:0];\nNSString  *filePath = [NSString stringWithFormat:@&quot;%@\u002F%@&quot;, documentsDirectory,@&quot;index.ios.bundle&quot;];\n\u003C\u002Fcode\u003E\u003C\u002Fpre\u003E\n\u003Cp\u003EUnder OPTION 2, asynchronously download file from server. Detect if the file exist in document directory, if the new bundle file exist, load from the document directory. Else, load from the pre-bundled file on the disk:\u003C\u002Fp\u003E\n\u003Cpre class=\"hljs\"\u003E\u003Ccode\u003Edispatch_async(dispatch_get_global_queue(DISPATCH_QUEUE_PRIORITY_DEFAULT, 0), ^{\n  NSURL  *url = [NSURL URLWithString:@&quot;http:\u002F\u002Flocalhost:8081\u002Findex.ios.bundle?platform=ios&amp;dev=true&quot;];\n  NSData *urlData = [NSData dataWithContentsOfURL:url];\n  if ( urlData )\n  {\n    \u002F\u002Fsaving is done on main thread\n    dispatch_async(dispatch_get_main_queue(), ^{\n      [urlData writeToFile:filePath atomically:YES];\n    });\n  }\n});\n\nBOOL fileExists = [[NSFileManager defaultManager] fileExistsAtPath:filePath];\nif (fileExists) {\n  jsCodeLocation = [[NSURL alloc] initFileURLWithPath:filePath];\n} else {\n  jsCodeLocation = [[NSBundle mainBundle] URLForResource:@&quot;main&quot; withExtension:@&quot;jsbundle&quot;];\n}\n\u003C\u002Fcode\u003E\u003C\u002Fpre\u003E\n\u003Ch2\u003ESome note\u003C\u002Fh2\u003E\n\u003Cp\u003EThis method still have many more enhancement can be done, however its enough to showcase the possibility of react native to asynchronously load file from server, and use the new bundle file when it is ready.\u003C\u002Fp\u003E\n",postedAt:"17 Oct, 2015",metaDescription:"In react native AwesomeProject example, it gets bundle files with 2 options:\n\nLoad from development server\nLoad from pre-bundled file on disk\n"}}]};if('serviceWorker' in navigator)navigator.serviceWorker.register('/service-worker.js');(function(){try{eval("async function x(){}");var main="/client/client.ef7c4807.js"}catch(e){main="/client/legacy/client.994d7ee4.js"};var s=document.createElement("script");try{new Function("if(0)import('')")();s.src=main;s.type="module";s.crossOrigin="use-credentials";}catch(e){s.src="/client/shimport@1.0.1.js";s.setAttribute("data-main",main);}document.head.appendChild(s);}());</script> 